define(["jquery","underscore"],function(n,t){"use strict";return function(n,e,o){var s,u,i,a,r,f,c,d,l,p,m,h,C,v,w,g,H,T,O,M,b={timeOut:!1,tolerance:{up:0,down:5},offset:0,topOffset:200};t.extend(b,o),s=function(){setTimeout(u,100)},u=function(){a=i(),n.vent.on("window:scrolled",r),e.on("mouseover",g).on("mouseout",H)},g=function(){O()},H=function(){var n=i();n>=b.topOffset&&T()},i=function(){return n.windowManager.$document.scrollTop()},r=function(n){var t=i(),e=n.down?"down":"up",o=d(t,e);l(t)||(t<=b.offset?p():m(),v(t,o,e)?C():w(t,o,e)&&h(),a=t)},d=function(n,t){return Math.abs(n-a)>=b.tolerance[t]},l=function(n){var t=0>n,e=n+f()>c();return t||e},f=function(){return n.windowManager.windowHeight},c=function(){var n=document.body,t=document.documentElement;return Math.max(n.scrollHeight,t.scrollHeight,n.offsetHeight,t.offsetHeight,n.clientHeight,t.clientHeight)},p=function(){e.hasClass("top")||e.addClass("top").removeClass("notTop")},m=function(){e.hasClass("notTop")||e.addClass("notTop").removeClass("top")},w=function(n,t,e){var o="up"===e,s=n<=b.offset;return o&&t||s},v=function(n,t,e){var o="down"===e,s=n>=b.offset;return o&&s&&t},C=function(){(e.hasClass("pinned")||!e.hasClass("unpinned"))&&(O(),e.addClass("unpinned").removeClass("pinned"))},h=function(){(e.hasClass("unpinned")||!e.hasClass("pinned"))&&(O(),e.addClass("pinned").removeClass("unpinned"),T())},T=function(){b.timeOut&&(M=setTimeout(function(){C()},b.timeOut))},O=function(){clearTimeout(M)},s()}});